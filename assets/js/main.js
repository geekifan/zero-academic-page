console.log('This site was generated by Hugo.');

document.addEventListener('DOMContentLoaded', function() {
    // process heading ids
    document.querySelectorAll('h1, h2, h3').forEach(heading => {
        // remove emojis and trim spaces
        const cleanText = heading.textContent.replace(/[\u{1F300}-\u{1F6FF}]|[\u{2600}-\u{26FF}]/gu, '').trim();
        // set id without leading dash
        if (!heading.id) {
            heading.id = cleanText.toLowerCase().replace(/\s+/g, '-');
        }
    });
    
    // toggle theme button
    const themeToggle = document.getElementById('theme-toggle-btn');
    const body = document.body;
    
    // check user's theme preference
    const storedTheme = localStorage.getItem('theme');
    if (storedTheme === 'dark') {
        body.classList.add('dark-mode');
        body.classList.remove('light-mode');
    } else {
        body.classList.add('light-mode');
        body.classList.remove('dark-mode');
    }
    
    // toggle theme button event
    themeToggle.addEventListener('click', function() {
        if (body.classList.contains('light-mode')) {
            body.classList.remove('light-mode');
            body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark');
        } else {
            body.classList.remove('dark-mode');
            body.classList.add('light-mode');
            localStorage.setItem('theme', 'light');
        }
    });
    
    // smooth scroll to anchor
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href').substring(1);
            if (!targetId) return;
            
            // try to find target element by id
            let targetElement = document.getElementById(targetId);
            
            // if target element is not found, try to find corresponding h2/h3 title
            if (!targetElement) {
                // find all h2 and h3 titles
                const headings = document.querySelectorAll('h2, h3');
                
                // iterate all titles, find the one that matches targetId
                for (const heading of headings) {
                    // get title text and remove emojis
                    const headingText = heading.textContent.trim().replace(/[\u{1F300}-\u{1F6FF}]|[\u{2600}-\u{26FF}]/gu, '').trim();
                    const targetText = decodeURIComponent(targetId).replace(/-/g, ' ').trim();
                    
                    // try multiple matching ways
                    if (headingText === targetText || 
                        headingText.toLowerCase() === targetText.toLowerCase() ||
                        heading.textContent.trim().startsWith(targetText) ||
                        heading.textContent.trim().toLowerCase().startsWith(targetText.toLowerCase())) {
                        targetElement = heading;
                        break;
                    }
                }
            }
            
            // if target element is found, scroll to it
            if (targetElement) {
                window.scrollTo({
                    top: targetElement.offsetTop - 80, // 80px offset considering fixed header
                    behavior: 'smooth'
                });
                
                // update URL without refreshing page
                history.pushState(null, null, `#${targetId}`);
            }
        });
    });
    
    // add click event to links in navscreen
    const navScreenLinks = document.querySelectorAll('#navscreen .nav-links-item a');
    navScreenLinks.forEach(link => {
        link.addEventListener('click', function() {
            // hide navscreen
            const navScreen = document.getElementById('navscreen');
            if (navScreen.classList.contains('is-active')) {
                closeNavbar();
            }
        });
    });
});

function toggleNavbar() {
    const toggleNavbarButton = document.getElementsByClassName('toggle-navbar-button')[0];
    toggleNavbarButton.classList.toggle('is-active');
    const navScreen = document.getElementById('navscreen');
    navScreen.classList.toggle('is-active');
    
    // toggle body scroll state
    if (navScreen.classList.contains('is-active')) {
        // lock body scroll
        document.body.style.overflow = 'hidden';
    } else {
        // restore body scroll
        document.body.style.overflow = '';
    }
}

function closeNavbar() {
    const toggleNavbarButton = document.getElementById('toggle-navbar-button');
    toggleNavbarButton.classList.remove('is-active');
    const navScreen = document.getElementById('navscreen');
    navScreen.classList.remove('is-active');
    
    // restore body scroll
    document.body.style.overflow = '';
}
